{% extends 'base+accounts.clean.html' %}

{% load i18n %}
{% load kwacros %}
{% load static %}
{% load adapters %}
{% load hotel_adapters %}
{% load components %}
{% load tagutils %}

{% block analytics_events %}
	{{ block.super }}

	{# freeform #}
	gtag(
		"event",
		"begin_checkout",
		{
			"value": {{ rate.estimated_commission|json }},
			"currency": {{ request.currency.code|json }},
			"items": [
				{
					"item_id": {{ hotel.id|json }},
					"item_name": {{ hotel.name|json }},
					"item_category": "Lodging",
					"item_category2": {{ hotel.type.analytics_name|json }},
					"commission": {{ rate.estimated_commission|price_per:num_rooms|json }},
					"price": {{ rate.total|price_per:num_rooms|json }},
					"quantity": {{ num_rooms|json }}
				}
			]
		}
	);
	{# endfreeform #}
{% endblock %}

{% block extra_head %}
	{{ block.super }}

	<script src="https://applepay.cdn-apple.com/jsapi/1.latest/apple-pay-sdk.js" crossorigin></script>
	<script src="https://js.connexpay.com/sdk/v1/connexpay.min.js"></script>
	<link
		rel="stylesheet"
		type="text/css"
		href="https://js.connexpay.com/sdk/v1/connexpay.min.css"
	>
{% endblock %}

{% block page_styles %}{% include '_elements/styles/book.css' only %}{% endblock %}

{% block title %}
	{% blocktrans trimmed with hotel_name=hotel.name %}
		Make a Reservation at {{ hotel_name }}
	{% endblocktrans %}
{% endblock %}

{% block robots_tag_content %}noindex, nofollow{% endblock %}

{% block header_class %}{{ block.super }} shadow-none lg:shadow-line-bottom{% endblock %}

{% kwacro new_window_icon %}
<svg class="icon" width="13px" height="13px" viewbox="0 0 13 13">
	<g fill="none" fill-rule="evenodd" stroke="none" stroke-width="1">
		<g id="offsite" transform="translate(1, 0)">
			<g
				id="Group"
				fill="#02b1e8"
				fill-rule="nonzero"
				transform="translate(7.2, 4) rotate(-90) translate(-7.2, -4) translate(3.2, 0)"
			>
				<path d="M8,2.72359375 L5.9643,4.70715 L1.3071625,0.050012496 L0.1643,1.192875 L4.82143752,5.85001248 L2.8184375,7.88571248 L7.54286248,7.88571248 C8,7.88571248 8,7.88571248 8,7.42857504 L8,2.72359375 Z"></path>
			</g>
			<polyline
				points="4.76640625 3.30214844 0.565234376 3.30214844 0.565234376 11.8148438 9.29902344 11.8148438 9.29902344 6.34746094"
				stroke="#02b1e8"
				stroke-width="2"
			></polyline>
		</g>
	</g>
</svg>
{% endkwacro %}

{% block header %}
	{{ block.super }}

	<div
		class="
			lg:hidden
			pl-6
			font-brand text-white
			bg-brand-blue
			select-none
		"
	>
		<div class="flex gap-1ch items-stretch w-full">
			<span
				class="
					basis-[15px] flex flex-col grow-0 shrink-0
					justify-center
				"
			>
				<svg
					class="h-auto w-[15px] align-middle"
					width="32px"
					height="32px"
					viewbox="0 0 32 32"
				>
					<title>{% trans 'Clock' %}</title>
					<g fill="none" fill-rule="evenodd" stroke="none" stroke-width="1">
						<g fill="white" fill-rule="nonzero">
							<path d="M16,10 C14.896,10 14,10.896 14,12 L14,17.2 L12.592,18.607 C12.092,19.107 12,19.578 12,20 C12,21.104 12.896,22 14,22 C14.578,22 15.04,21.759 15.392,21.408 L17.463,19.338 C17.76,19.041 18,18.578 18,18 L18,12 C18,10.896 17.104,10 16,10 Z M16,4 C8.268,4 2,10.268 2,18 C2,21.151 3.054,24.05 4.811,26.39 L2.581,28.62 C2.193,29.006 2,29.469 2,30 C2,31.188 3.016,32 4,32 C4.516,32 4.986,31.814 5.38,31.42 L7.61,29.19 C9.95,30.946 12.849,32 16,32 C19.151,32 22.05,30.946 24.39,29.189 L26.62,31.419 C27.014,31.814 27.484,32 28,32 C28.984,32 30,31.187 30,30 C30,29.469 29.807,29.006 29.42,28.62 L27.19,26.39 C28.946,24.05 30,21.151 30,18 C30,10.268 23.732,4 16,4 Z M16,28 C10.478,28 6,23.522 6,18 C6,12.478 10.478,8 16,8 C21.522,8 26,12.478 26,18 C26,23.522 21.522,28 16,28 Z M26,0 C23.87,0 22.004,1.113 20.939,2.786 C24.872,4.061 28.138,6.811 30.078,10.392 C31.258,9.297 32,7.736 32,6 C32,2.687 29.313,0 26,0 Z M11.061,2.786 C9.996,1.113 8.13,0 6,0 C2.687,0 0,2.687 0,6 C0,7.736 0.742,9.297 1.922,10.393 C3.861,6.812 7.128,4.062 11.061,2.786 Z"></path>
						</g>
					</g>
				</svg>
			</span>
			<span
				class="
					basis-full flex flex-col flex-grow flex-shrink
					justify-center
					leading-tight tracking-tight
				"
			>
				{% if hotel.is_rental %}
					<span>{% blocktrans with type=hotel.structure_type_display|lower %}This {{ type }} can be booked&nbsp;instantly.{% endblocktrans %}</span>
				{% else %}
					<span>{% trans 'Hurry! Pet-friendly rooms are&nbsp;limited.' %}</span>
				{% endif %}
			</span>
			<button
				type="button"
				class="
					flex
					gap-icon items-center
					pl-4 pr-6 py-3
					whitespace-nowrap
					border-l border-s-white
				"
				subpage="compactRateSummary"
			>
				<span class="text-lg">
					{% format_currency rate.grand_total_with_extras request is_final=True is_in_usa=is_in_usa value_span_class='runningGrandTotal' %}
				</span>
				<svg class="align-middle" width="12" height="8" viewbox="0 0 12 8">
					<g fill="none" stroke="white" stroke-width="2px" transform="translate(1, 1)">
						<polyline points="0 0 4.75 3.8 9.5 0"></polyline>
					</g>
				</svg>
			</button>
		</div>
	</div>
{% endblock %}

{% block logo_href %}{% endblock %}

{% kwacro stars %}
{% if hotel.fido_rating or hotel.external_rating %}
	<div class="shrink-0 whitespace-nowrap">
		{% if hotel.fido_rating %}
			{% render_bones hotel.fido_rating is_amp=False %}
		{% elif hotel.external_rating.source.slug != 'tripadvisor' %}
			{% include '_elements/entity/stars.html' with rating=hotel.external_rating only %}
		{% endif %}
	</div>
{% endif %}
{% endkwacro %}

{% block body_main %}
	<div
		class="
			mx-auto pb-16 pt-4 lg:pt-8 px-6
			max-w-box
			@container
		"
	>
		<form id="bookReservationForm" action="" method="POST" novalidate>
			<input type="hidden" name="instance_code" value="{{ instance_code }}">
			<input
				type="hidden"
				name="kount_session_id"
				:value="$store.kount.sessionID || ''"
				x-data
			>

			<input type="hidden" id="applePayData" name="apple_pay_data" value="">

			<div
				class="
					grid
					grid-cols-[minmax(0,1fr)]
					grid-flow-col
					grid-rows-[auto_auto]
					lg:grid-cols-[repeat(3,minmax(0,1fr))]
					lg:grid-flow-row
					gap-8
					box-border lg:auto-rows-auto
				"
			>
				<div class="lg:col-span-2 flex flex-col flex-grow gap-s4">
					<div class="lg:flex flex-col hidden gap-s-1">
						<h1 class="text-4xl">
							{{ heading_text }}
						</h1>
						{% if not errors and not form.errors and not card_form.errors %}
							<div class="hurry" {% if page == 2 %}hidden{% endif %}>
								<div
									class="
										float-left
										flex
										gap-1ch items-center
										px-3 py-2
										font-brand tracking-tight
										bg-gray-field
										rounded-super-base
									"
								>
									{% if hotel.pets_allowed %}
										<span class="flex flex-col justify-center">
											<svg
												class="h-auto w-[15px]"
												width="32px"
												height="32px"
												viewbox="0 0 32 32"
											>
												<title>{% trans 'Clock' %}</title>
												<g
													fill="none"
													fill-rule="evenodd"
													stroke="none"
													stroke-width="1"
												>
													<g class="fill-dark" fill-rule="nonzero">
														<path d="M16,10 C14.896,10 14,10.896 14,12 L14,17.2 L12.592,18.607 C12.092,19.107 12,19.578 12,20 C12,21.104 12.896,22 14,22 C14.578,22 15.04,21.759 15.392,21.408 L17.463,19.338 C17.76,19.041 18,18.578 18,18 L18,12 C18,10.896 17.104,10 16,10 Z M16,4 C8.268,4 2,10.268 2,18 C2,21.151 3.054,24.05 4.811,26.39 L2.581,28.62 C2.193,29.006 2,29.469 2,30 C2,31.188 3.016,32 4,32 C4.516,32 4.986,31.814 5.38,31.42 L7.61,29.19 C9.95,30.946 12.849,32 16,32 C19.151,32 22.05,30.946 24.39,29.189 L26.62,31.419 C27.014,31.814 27.484,32 28,32 C28.984,32 30,31.187 30,30 C30,29.469 29.807,29.006 29.42,28.62 L27.19,26.39 C28.946,24.05 30,21.151 30,18 C30,10.268 23.732,4 16,4 Z M16,28 C10.478,28 6,23.522 6,18 C6,12.478 10.478,8 16,8 C21.522,8 26,12.478 26,18 C26,23.522 21.522,28 16,28 Z M26,0 C23.87,0 22.004,1.113 20.939,2.786 C24.872,4.061 28.138,6.811 30.078,10.392 C31.258,9.297 32,7.736 32,6 C32,2.687 29.313,0 26,0 Z M11.061,2.786 C9.996,1.113 8.13,0 6,0 C2.687,0 0,2.687 0,6 C0,7.736 0.742,9.297 1.922,10.393 C3.861,6.812 7.128,4.062 11.061,2.786 Z"></path>
													</g>
												</g>
											</svg>
										</span>
									{% endif %}
									<span>
										{% if hotel.is_rental %}
											{% blocktrans with type=hotel.structure_type_display|lower %}This {{ type }} can be booked instantly.{% endblocktrans %}
										{% elif hotel.pets_allowed %}
											{% trans 'Hurry! Pet-friendly rooms are limited.' %}
										{% else %}
											{% trans 'Heads up! Pets are NOT allowed at this hotel.' %}
										{% endif %}
									</span>
								</div>
							</div>
						{% endif %}
					</div>

					{% if errors or form.errors or card_form.errors %}{# Got errors back from Expedia #}
						<div
							class="
								flex flex-col
								gap-s-1
								px-3 py-2
								font-brand text-error
								bg-error
								rounded-super-base
							"
						>
							{% if errors %}
								{# These should be self-explanatory and not need any introduction. #}
								<ul class="flex flex-col gap-s-1">
									{% for error in errors %}
										<li>{{ error }}</li>
									{% endfor %}
								</ul>
							{% else %}
								<p>{% trans 'Please fix the errors below…' %}</p>
								{{ form.non_field_errors }}
								{{ card_form.non_field_errors }}
								{# The rest of the errors will be shown near the associated field, below #}
								<!--
									Errors:
									{{ form.errors }}
									{{ card_form.errors }}
								-->
							{% endif %}
						</div>
					{% endif %}

					<div
						id="page1Summary"
						class="flex flex-col gap-s-1"
						{% if page == 1 %}hidden{% endif %}
					>
						<div
							class="
								flex
								p-3
								bg-gray-field
								border-1 border-gray-line rounded-super-base
							"
						>
							<div
								id="pageSummary__text"
								class="
									basis-full flex-shrink
									text-ellipsis whitespace-nowrap
									overflow-hidden
								"
							><strong>Guest Details:</strong> {{ form.first_name.value }} {{ form.last_name.value }}, {{ form.address_1.value }}</div>
							<button type="button" id="pageSummary__changeBtn" class="link">
								{% trans 'Change' %}
							</button>
						</div>

						<hr>
					</div>

					<div
						id="page1"
						class="flex flex-col gap-s0"
						{% if page == 2 %}hidden{% endif %}
					>
						<section class="flex flex-col lg:hidden gap-s-1">
							<div class="flex gap-3 items-center justify-between w-full">
								<h2 class="shrink leading-tight text-xl">{{ hotel.name }}</h2>
								{% usekwacro stars %}
							</div>

							<p>
								{{ room_display_html|safe }}
							</p>

							<div class="flex gap-6 justify-between">
								<div class="basis-1/3 shrink-0">
									<img
										class="rounded-super-base"
										src="{{ room_type.thumbnail.url_full }}"
										alt="{{ room_type.beds_display }}"
										decoding="async"
									>
								</div>
								<div class="basis-full flex flex-col gap-s-1 max-w-data">
									<div>
										<div class="flex gap-3 justify-between">
											<span class="font-bold font-brand text-dark">
												{% trans 'Guests' %}
											</span>
											<span>
												{% blocktrans count c=num_adults %}{{ c }} adult{% plural %}{{ c }} adults{% endblocktrans %}{% if num_children or num_pets %},{% endif %}
												{% if num_children %}
													{% blocktrans count c=num_children %}{{ c }} child{% plural %}{{ c }} children{% endblocktrans %}{% if num_pets %},{% endif %}
												{% endif %}
												{% blocktrans count c=num_pets %}{{ c }} pet{% plural %}{{ c }} pets{% endblocktrans %}
											</span>
										</div>
										<div class="flex gap-3 justify-between">
											<span class="font-bold font-brand text-dark">
												{% trans 'Length of Stay' %}
											</span>
											<span>
												{{ num_nights }} {% trans 'night' %}{{ num_nights|pluralize }}
											</span>
										</div>
										<div class="flex gap-3 justify-between">
											<span class="font-bold font-brand text-dark">
												{% trans 'Arrival' %}
											</span>
											<span>
												{{ arrival|date:date_format_string }}
											</span>
										</div>
										<div class="flex gap-3 justify-between">
											<span class="font-bold font-brand text-dark">
												{% trans 'Departure' %}
											</span>
											<span>
												{{ departure|date:date_format_string }}
											</span>
										</div>
									</div>

									<div class="text-right">
										<p x-data>
											<button
												type="button"
												class="link"
												@click.prevent="$dispatch('modal', {key: 'tripDetails'});"
											>
												{% trans 'Change details' %}
											</button>
										</p>
									</div>
								</div>
							</div>
						</section>

						<hr class="lg:hidden">

						<div class="flex flex-col gap-s4">
							<section class="flex flex-col gap-s4">
								<div class="flex flex-col gap-s-1">
									<div class="flex items-center justify-between w-full">
										<h1>{% trans 'Guest Details' %}</h1>

										{% if user.is_authenticated %}
											{% if is_guest_known %}
												<button type="button" class="guestFieldsBtn link">
													{% trans 'Modify guest info' %}
												</button>
											{% endif %}
										{% else %}
											<button
												type="button"
												class="link"
												x-data
												@click="$store.popout.set('registration', 'login')"
											>
												{% trans 'Sign in to book faster' %}
											</button>
										{% endif %}
									</div>

									{% if is_guest_known %}
										<p class="guestSummary">
											{{ form.first_name.value }} {{ form.last_name.value }}
											{% if is_address_known %}
												<br>
												{{ form.address_1.value }}
												{% if form.address_2.value %}
													{{ form.address_2.value }}
												{% endif %}
												<br>
												{{ form.city.value }}{% if form.state.value %},{% endif %}
												{% if form.state.value %}
													{{ form.state.value }}
												{% endif %}
												{{ form.postal_code.value }}
											{% endif %}
											<br>
											{{ form.phone.value }}
										</p>
									{% endif %}

									<div
										class="flex flex-col gap-3 guestFields"
										{% if is_guest_known %}hidden{% endif %}
									>
										<div class="flex gap-3 justify-between">
											<div class="relative basis-1/2">
												{{ form.first_name }}
												<label for="id_first_name">{% trans 'First name' %}</label>
												{{ form.first_name.errors }}
											</div>
											<div class="relative basis-1/2">
												{{ form.last_name }}
												<label for="id_last_name">{% trans 'Last name' %}</label>
												{{ form.last_name.errors }}
											</div>
										</div>

										<div class="relative">
											{{ form.phone }}
											<label for="id_phone">{% trans 'Phone number' %}</label>
											{{ form.phone.errors }}
										</div>

										<div class="relative">
											{{ form.email }}
											<label for="id_email">{% trans 'Email address' %}</label>
											{{ form.email.errors }}
										</div>
									</div>
								</div>

								<div
									class="flex flex-col gap-s-1 addressFields"
									{% if is_guest_known and is_address_known %}hidden{% endif %}
								>
									{% if is_address_known and not is_guest_known %}
										<div class="flex items-center justify-between w-full">
											<h2 class="text-xl">{% trans 'Address' %}</h2>
											<button
												type="button"
												class="addressFieldsBtn guestSummary link"
											>
												{% trans 'Modify address' %}
											</button>
										</div>

										<p class="guestSummary">
											{{ user.mailing_address_1 }}
											{% if user.mailing_address_2 %}
												{{ user.mailing_address_2 }}
											{% endif %}
											<br>
											{{ user.mailing_city }}{% if user.mailing_state %},{% endif %}
											{% if user.mailing_state %}
												{{ user.mailing_state.code }}
											{% endif %}
											{{ user.mailing_postal_code }}
										</p>
									{% else %}
										<h2 class="text-xl">{% trans 'Address' %}</h2>
									{% endif %}

									<div
										class="flex flex-col gap-3 addressFields"
										{% if is_address_known %}hidden{% endif %}
										x-data="addressAutocomplete({ address1: '{{ form.address_1.value|default_if_none:''|escapejs }}'})"
									>
										<div class="relative">
											{{ form.country }}
											<label for="id_country">{% trans 'Country' %}</label>
											{{ form.country.errors }}
										</div>

										<div class="relative">
											{{ form.address_1 }}
											<label for="id_address_1">{% trans 'Street address' %}</label>
											{{ form.address_1.errors }}
											<ul
												id="addressAutocompleteDropdown"
												class="
													absolute z-1
													empty:hidden
													peer-[&:not(:focus)]:hidden
													-mt-[var(--input-border-width)]
													w-full
													overflow-hidden
													bg-white
													border-light
													rounded-super-sm
													rounded-t-none
													shadow-high-beneath
													border
												"
												x-cloak
												x-show="suggestions.length"
											>
												<template x-for="(suggestion, index) in suggestions">
													<li
														class="
															px-(--input-padding-y)
															py-(--input-padding-y)
															w-full
															text-dark
															text-lg
															hover:text-white
															whitespace-nowrap
															hover:bg-brand-blue
															cursor-default
														"
														:class="{'bg-gray-field': focusIndex === index}"
														x-data="{selectionIndex: index}"
														x-text="suggestion.text"
														@mousedown="suggestionClick($data)"
													>
													</li>
												</template>
												<li hidden x-ref="placesAttribution"></li>
											</ul>
										</div>

										<div class="relative">
											{{ form.address_2 }}
											<label for="id_address_2">{% trans 'Apartment (optional)' %}</label>
											{{ form.address_2.errors }}
										</div>

										<div
											class="
												flex flex-col md:flex-row
												gap-3 justify-between
											"
										>
											<div class="relative basis-1/2">
												{{ form.city }}
												<label for="id_city">{% trans 'City' %}</label>
												{{ form.city.errors }}
											</div>
											<div
												id="stateContainer"
												class="relative basis-1/2"
												{% if not form.selected_country.uses_states %}
													hidden
												{% endif %}
											>
												{{ form.state }}
												<label for="id_state">{{ form.selected_country.word_for_state }}</label>
												{{ form.state.errors }}
											</div>
											<div class="relative basis-1/2">
												{{ form.postal_code }}
												<label for="id_postal_code">{% if form.selected_country.code == 'US' %}{% trans 'Zip code' %}{% else %}{% trans 'Postal code' %}{% endif %}</label>
												{{ form.postal_code.errors }}
											</div>
										</div>
									</div>
								</div>

								{% if not user.is_authenticated %}
									<div class="flex flex-col gap-s-1">
										<p>
											{% blocktrans trimmed %}
												Want to save your info for future bookings? Enter a password to create a BringFido account.
											{% endblocktrans %}
										</p>
										<div class="relative">
											{{ form.password }}
											<label for="id_password">{% trans 'Create a password (optional)' %}</label>
											{{ form.password.errors }}
										</div>

										<div class="relative">
											<div id="passwordStrength" hidden>
												<div
													class="
														h-1
														bg-gray-field
														rounded-full
														passwordStrength__meter
													"
												></div>
												<div class="passwordStrength__description">
													{% trans 'Password Strength' %}:
													<span
														class="
															font-bold font-brand
															passwordStrength__description__value
														"
													></span>
												</div>
											</div>
										</div>
									</div>
								{% endif %}
							</section>

							{% if user and user.pets_list %}
								<section class="flex flex-col gap-s4">
									<div class="flex flex-col gap-s-1">
										<h1>{% trans 'Pet Information' %}</h1>
										<p>{% trans 'Who’s traveling with you?' %}</p>

										<div class="flex flex-wrap gap-3">
											{% for pet in user.pets_list %}
												<label
													for="pet{{ pet.id }}"
													class="
														flex
														gap-1ch items-center
														px-3 py-2
														for-checked:bg-gray-field
														border-gray-line
														rounded-super-base
														select-none
														checkedLabel
														{% if pet.id in selected_pet_ids %}
															for-checked
														{% endif %}
														border
													"
												>
													<input
														type="checkbox"
														id="pet{{ pet.id }}"
														name="pet"
														value="{{ pet.id }}"
														{% if pet.id in selected_pet_ids %}
															checked
														{% endif %}
													>
													<span class="font-brand">{{ pet.name }}</span>
													<span>
														{% if pet.avatar %}
															<img
																class="rounded-full"
																src="{{ pet.get_avatar_url }}"
																width="40"
																height="40"
																alt="{{ pet.type.name }}"
															>
														{% endif %}
													</span>
												</label>
											{% endfor %}
										</div>
									</div>
								</section>
							{% endif %}

							<section class="flex flex-col gap-s4">
								<div class="flex flex-col gap-s-1">
									<h1>{% trans 'Special Requests' %}</h1>
									<p>{% trans 'Our Canine Concierge ensures that all BringFido members are assigned to a pet-friendly room. If you have any other requests, please note them here.' %}</p>
									<div class="relative">
										{{ form.special_request }}
										{{ form.special_request.errors }}
									</div>
									<div class="relative">
										<details
											class="flex flex-col gap-4"
											{% if form.gift_code.value %}open{% endif %}
										>
											<summary class="link">{% trans 'Add promo code' %}</summary>

											<div class="flex w-full">
												<span class="relative flex-grow max-w-60">
													{{ form.gift_code }}
													<label for="giftCodeInput">{% trans 'Promo code (optional)' %}</label>
													<div id="giftCodeStatusCtr"></div>
												</span>
												<button
													type="button"
													id="giftCodeApplyBtn"
													class="
														flex-none
														px-3 py-2
														text-lg
														rounded-s-none
														button
													"
													disabled
												>
													{% trans 'Apply' %}
												</button>
											</div>
										</details>
									</div>
								</div>
							</section>

							<hr>

							<div class="text-center">
								<button
									type="button"
									id="continueBtn"
									class="w-full md:w-1/3 text-xl button"
								>Continue</button>
							</div>
						</div>
					</div>

					<div
						id="page2"
						class="flex flex-col gap-s4"
						{% if page == 1 %}hidden{% endif %}
					>
						<section class="flex flex-col gap-s0">
							<div class="flex items-stretch justify-between">
								<h1>{% trans 'Payment Method' %}</h1>

								<div class="flex flex-col justify-center cursor-default group">
									<div class="relative">
										<span
											class="
												flex
												gap-1 items-center
												font-bold font-brand text-sm text-touch
											"
										>
											<svg
												class="icon"
												width="10px"
												height="12px"
												viewbox="0 0 10 12"
											>
												<title>{% trans 'Lock' %}</title>
												<g
													fill="none"
													fill-rule="evenodd"
													stroke="none"
													stroke-width="1"
												>
													<g transform="translate(-2, -1)">
														<rect width="14" height="14" x="0" y="0"></rect>
														<path
															d="M10.6145051,6.37285507 C10.8106509,6.37285507 10.9780624,6.44225853 11.1168045,6.58100058 C11.2555465,6.71974263 11.32495,6.88721902 11.32495,7.0833 L11.32495,12.0561551 C11.32495,12.2523009 11.2555465,12.4197124 11.1168045,12.5584545 C10.9780624,12.6971965 10.8106509,12.7666 10.6145051,12.7666 L3.51038007,12.7666 C3.31429909,12.7666 3.14688756,12.6971965 3.00814551,12.5584545 C2.86940346,12.4197124 2.8,12.2523009 2.8,12.0561551 L2.8,7.0833 C2.8,6.88721902 2.86940346,6.71974263 3.00814551,6.58100058 C3.14688756,6.44225853 3.31429909,6.37285507 3.51038007,6.37285507 L4.220825,6.37285507 L4.220825,4.24165 C4.220825,3.85681755 4.29574181,3.48962786 4.44557545,3.13995118 C4.59547395,2.79027451 4.79804123,2.48781813 5.05334218,2.23251718 C5.30864313,1.97721623 5.61109951,1.77464895 5.96077618,1.62475045 C6.31045286,1.47491681 6.67764255,1.4 7.062475,1.4 C7.44730742,1.4 7.81449711,1.47491681 8.16417385,1.62475045 C8.51385052,1.77464895 8.81630687,1.97721623 9.07160779,2.23251718 C9.32690878,2.48781813 9.52947604,2.79027451 9.67930971,3.13995118 C9.8292082,3.48962786 9.904125,3.85681755 9.904125,4.24165 L9.904125,6.37285507 L10.6145051,6.37285507 Z M5.64165,4.24165 L5.64165,6.37285507 L8.4833,6.37285507 L8.4833,4.24165 C8.4833,3.84942317 8.34455797,3.51460013 8.06700895,3.23711602 C7.78952489,2.95956705 7.4547018,2.820825 7.062475,2.820825 C6.67024817,2.820825 6.33542513,2.95956705 6.05787616,3.23711602 C5.78039205,3.51460013 5.64165,3.84942317 5.64165,4.24165 Z"
															fill="#888888"
														></path>
													</g>
												</g>
											</svg>
											{% trans 'This booking is secure.' %}
										</span>

										<div
											class="
												absolute
												after:absolute
												bottom-full
												-right-2
												after:right-1/2
												after:top-full
												after:content-['']
												p-3
												min-w-40
												text-sm text-white
												bg-dark
												after:border-x-6
												after:border-x-transparent
												after:border-t-6
												after:border-t-dark
												rounded-super-sm
												scale-90
												group-hover:scale-100
												-translate-y-2
												after:translate-x-1/2
												transition-transform
												antialiased
												invisible
												group-hover:visible
											"
										>
											{% blocktrans trimmed %}
												All transactions are secure and encrypted.
											{% endblocktrans %}
										</div>
									</div>
								</div>
							</div>

							<div
								id="paymentTypeChooser"
								class="flex flex-col gap-2 text-lg"
								{% if not is_apple_pay_eligible %}hidden{% endif %}
							>
								<div reference="credit_card">
									<label class="flex flex-row gap-1ch items-center">
										<input
											type="radio"
											id="creditCardOption"
											name="paymentTypeOptionSelect"
											value="creditCard"
											{% if selected_payment_method_type != "apple_pay" %}
												checked
											{% endif %}
										>
										<div class="flex flex-row-reverse gap-1ch items-center">
											<span>{% trans 'Credit Card' %}</span>

											<img
												class="h-auto w-10"
												src="{% static 'images/icons/cards/card_generic.svg' %}"
												alt="{% trans 'Credit Card' %}"
											>
										</div>
									</label>
								</div>
								<div reference="apple_pay">
									<label class="flex flex-row gap-1ch items-center">
										<input
											type="radio"
											id="applePayOption"
											name="paymentTypeOptionSelect"
											value="applePay"
											{% if selected_payment_method_type == "apple_pay" %}
												checked
											{% endif %}
										>
										<div class="flex flex-row-reverse gap-1ch items-center">
											<span>{% trans 'Apple Pay' %}</span>

											<img
												class="h-auto w-10"
												src="{% static 'images/icons/cards/apple_pay_mark.svg' %}"
												alt="{% trans 'Apple Pay' %}"
											>
										</div>
									</label>
								</div>
							</div>

							{% if user and user.payment_methods_list %}
								<div id="existingPaymentMethods" class="flex flex-wrap gap-3">
									<div class="basis-100 grow shrink">
										<select
											id="paymentMethodSelect"
											class="
												[&[data-image-slug]]:ps-11
												[&[data-image-slug=amex]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/amex.svg)]
												[&[data-image-slug=discover]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/discover.svg)]
												[&[data-image-slug=jcb]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/jcb.svg)]
												[&[data-image-slug=mastercard]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/mastercard.svg)]
												[&[data-image-slug=other]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/other.svg)]
												[&[data-image-slug=visa]]:bg-[url(/assets/images/icons/dropdown.svg),url(/assets/images/icons/cards/visa.svg)]
												[&[data-image-slug]]:bg-position-[right_calc(2_*_var(--spacing))_center,left_calc(2_*_var(--spacing))_center]
												truncate
											"
											name="payment_method"
											{% if selected_payment_method %}
												data-image-slug="{{ selected_payment_method.image_slug }}"
											{% endif %}
										>
											{% for payment_method in user.payment_methods_list %}
												<option
													value="{{ payment_method.id }}"
													{% if payment_method.selected %}
														selected
													{% endif %}
													data-image-slug="{{ payment_method.image_slug }}"
												>{{ payment_method.selection_text }}</option>
											{% endfor %}
											<option
												value=""
												{% if not selected_payment_method %}
													selected
												{% endif %}
											>{% trans 'New credit card' %}</option>
										</select>
									</div>
									<div
										id="savedCardSecurityCodeContainer"
										class="basis-44 grow"
										{% if not selected_payment_method %}hidden{% endif %}
									>
										<div class="relative" reference="security_code_1">
											<input
												type="text"
												id="securityCode1"
												class="
													w-full
													{% if form.security_code.errors %}
														text-error
														border-error
													{% endif %}
													mask--securityCode
													adaptiveLabel
													existingPaymentMethodField
												"
												name="security_code_1"
												value=""
												pattern="\d*"
												maxlength="4"
												required
												autocomplete="cc-csc"
												validate="security_code"
											>
											<label for="securityCode1">{% trans 'Security code' %}</label>

											<div
												class="
													absolute right-0 top-1/2
													flex flex-col
													justify-center
													pr-3
													h-6
													-translate-y-1/2
													group
												"
											>
												<span
													class="
														inline-flex
														items-center justify-center
														h-4 w-4
														font-bold
														font-brand
														text-white
														bg-touch
														rounded-full
														cursor-pointer
														antialiased
													"
												>?</span>
												<div
													class="
														absolute
														after:absolute
														bottom-full
														-right-2
														after:right-[22px]
														after:top-full
														after:content-['']
														p-3
														min-w-38
														text-sm text-white
														bg-dark
														after:border-x-6
														after:border-x-transparent
														after:border-t-6
														after:border-t-dark
														rounded-super-sm
														scale-90
														group-hover:scale-100
														-translate-y-2
														transition-transform
														antialiased
														invisible
														group-hover:visible
													"
												>
													<div
														class="
															securityCodeText
															securityCodeText--default
														"
													>
														{% blocktrans trimmed %}
															3-digit security code usually found on the back of your card. American Express cards have a 4-digit code located on the front.
														{% endblocktrans %}
													</div>
													<div
														class="
															securityCodeText
															securityCodeText--3
														"
														hidden
													>
														{% blocktrans trimmed %}
															3-digit security code on the back of your card.
														{% endblocktrans %}
													</div>
													<div
														class="
															securityCodeText
															securityCodeText--4
														"
														hidden
													>
														{% blocktrans trimmed %}
															4-digit security code on the front of your card.
														{% endblocktrans %}
													</div>
												</div>
											</div>
										</div>

										{{ form.security_code.errors }}
									</div>
								</div>
							{% endif %}

							<div
								id="newPaymentMethod"
								class="flex flex-col gap-3"
								{% if selected_payment_method %}hidden{% endif %}
							>
								<div class="flex gap-1 justify-end">
									<img
										class="
											transition-all
											cardTypeIndicator cardTypeIndicator-visa
										"
										src="{% static 'images/icons/cards/visa.svg' %}"
										alt="{% trans 'Visa' %}"
									>
									<img
										class="
											transition-all
											cardTypeIndicator
											cardTypeIndicator-mastercard
										"
										src="{% static 'images/icons/cards/mastercard.svg' %}"
										alt="{% trans 'MasterCard' %}"
									>
									{% if rate.accepts_amex %}
										<img
											class="
												transition-all
												cardTypeIndicator
												cardTypeIndicator-amex
											"
											src="{% static 'images/icons/cards/amex.svg' %}"
											alt="{% trans 'American Express' %}"
										>
									{% endif %}
									{% if rate.accepts_discover %}
										<img
											class="
												transition-all
												cardTypeIndicator
												cardTypeIndicator-discover
											"
											src="{% static 'images/icons/cards/discover.svg' %}"
											alt="{% trans 'Discover' %}"
										>
									{% endif %}
									{% if rate.accepts_jcb %}
										<img
											class="
												transition-all
												cardTypeIndicator cardTypeIndicator-jcb
											"
											src="{% static 'images/icons/cards/jcb.svg' %}"
											alt="{% trans 'JCB' %}"
										>
									{% endif %}
									{% if rate.accepts_other %}
										<img
											class="
												transition-all
												cardTypeIndicator
												cardTypeIndicator-other
											"
											src="{% static 'images/icons/cards/other.svg' %}"
											alt="{% trans 'Other' %}"
										>
									{% endif %}
								</div>

								<div class="relative">
									{{ card_form.number }}
									<label for="creditCardNumberInput">{% trans 'Card number' %}</label>
									{{ card_form.number.errors }}
								</div>

								<div class="flex gap-3">
									<div class="relative basis-1/2">
										<input
											type="text"
											id="expiry"
											class="
												adaptiveLabel
												{% if formatted_expiry %}
													adaptiveLabel--withContent
												{% endif %}
												mask--monthAndYear
												{% if card_form.expiry_month.errors %}
													error
												{% endif %}
												newPaymentMethodField
											"
											name="expiry"
											value="{{ formatted_expiry }}"
											pattern="\d*"
											maxlength="10"
											required
											autocomplete="cc-exp"
											validate
										>
										<label for="expiry">
											{% trans 'Expires' %}
											(MM/YY{% if formatted_expiry|length > 7 %}YY{% endif %})
										</label>
										{{ card_form.expiry_month.errors }}
									</div>
									<div class="relative basis-1/2" reference="security_code_2">
										<input
											type="text"
											id="securityCode2"
											class="
												{% if form.security_code.errors %}
													text-error
													border-error
												{% endif %}
												mask--securityCode
												adaptiveLabel
												newPaymentMethodField
											"
											name="security_code_2"
											value=""
											pattern="\d*"
											maxlength="4"
											required
											autocomplete="cc-csc"
											validate="security_code"
										>
										<div
											class="
												absolute right-0 top-1/2
												flex flex-col
												justify-center
												pr-3
												h-6
												-translate-y-1/2
												group
											"
										>
											<span
												class="
													inline-flex
													items-center justify-center
													h-4 w-4
													font-bold font-brand text-white
													bg-touch
													rounded-full
													cursor-pointer
													antialiased
												"
											>?</span>
											<div
												class="
													absolute
													after:absolute
													bottom-full
													-right-2
													after:right-[22px]
													after:top-full
													after:content-['']
													p-3
													min-w-48
													text-sm text-white
													bg-dark
													after:border-x-6
													after:border-x-transparent
													after:border-t-6
													after:border-t-dark
													rounded-super-sm
													scale-90
													group-hover:scale-100
													-translate-y-2
													transition-transform
													antialiased
													invisible
													group-hover:visible
												"
											>
												<div
													class="
														securityCodeText
														securityCodeText--default
													"
												>
													{% blocktrans trimmed %}
														3-digit security code usually found on the back of your card. American Express cards have a 4-digit code located on the front.
													{% endblocktrans %}
												</div>
												<div
													class="
														securityCodeText
														securityCodeText--3
													"
													hidden
												>
													{% blocktrans trimmed %}
														3-digit security code on the back of your card.
													{% endblocktrans %}
												</div>
												<div
													class="
														securityCodeText
														securityCodeText--4
													"
													hidden
												>
													{% blocktrans trimmed %}
														4-digit security code on the front of your card.
													{% endblocktrans %}
												</div>
											</div>
										</div>
										<label for="securityCode2">{% trans 'Security code' %}</label>
										{{ form.security_code.errors }}
									</div>
								</div>

								<div class="relative">
									{{ card_form.name }}
									<label for="id_name">{% trans 'Name on card' %}</label>
									{{ card_form.name.errors }}
								</div>

								{% if not user.is_staff %}
									<div
										id="saveForLaterRow"
										{% if page == 2 and not form.password.value and not user.is_authenticated %}
											hidden
										{% endif %}
									>
										<label
											for="saveForLater"
											class="flex gap-1ch items-center"
										>
											<input
												type="checkbox"
												id="saveForLater"
												class="newPaymentMethodField"
												name="save_for_later"
												{% if is_save_checked %}checked{% endif %}
											>
											{% trans 'Save this credit card for future bookings' %}
										</label>
									</div>
								{% endif %}
							</div>
						</section>

						<section class="flex flex-col gap-s-1">
							<h1>
								{% trans 'Hotel Policies &amp; Information' %}
							</h1>

							<div id="moreInfo" class="flex flex-col gap-s0">
								{% if has_additional_information %}
									<p>
										{% if hotel.is_rental %}
											{% blocktrans trimmed %}
												Stay out of the “dog house” by following these
												<button
													type="button"
													class="link"
													subpage="additionalRules"
												>additional rules</button>
												provided by the host. You will be responsible for any damage caused by you or your pets during your stay.
											{% endblocktrans %}
										{% else %}
											{% blocktrans trimmed with property_type=hotel.type.singular_name|lower %}
												Stay out of the “dog house” by following these
												<button
													type="button"
													class="link"
													subpage="additionalRules"
												>additional rules</button>
												provided by the {{ property_type }}.
											{% endblocktrans %}
										{% endif %}
									</p>
								{% endif %}

								{% if hotel_details.house_rules_display %}
									<h3 class="text-base">
										{% trans 'House Rules' %}
									</h3>
									{{ hotel_details.house_rules_display }}
								{% endif %}

								{% if hotel_details.check_in_time %}
									<div class="flex flex-row gap-3">
										<div class="basis-1/2 flex flex-col gap-1">
											<h3 class="text-lg">
												{% trans 'Check-in' %}
											</h3>
											{{ hotel_details.check_in_time }}
										</div>
										{% if hotel_details.check_out_time %}
											<div class="basis-1/2 flex flex-col gap-1">
												<h3 class="text-lg">
													{% trans 'Check-out' %}
												</h3>
												{{ hotel_details.check_out_time }}
											</div>
										{% endif %}
									</div>
								{% endif %}

								<div class="flex flex-col gap-1 max-w-content">
									<h3 class="text-lg">
										{% trans 'Cancellation Policy' %}
									</h3>
									<div
										class="
											flex flex-col
											gap-3
											[&_ul]:ms-3
											[&_ul]:list-disc
											[&_ul]:list-inside
										"
									>
										{% make_cancellation_policy_html_safe request hotel rate arrival %}

										{% if not is_same_day_arrival %}
											<div
												class="
													flex flex-col
													gap-1
													ps-2
													insuranceOptions
												"
												{% if not insurance_quote %}hidden{% endif %}
											>
												<div reference="pet_travel_insurance">
													<label
														for="travelInsurance--yes"
														class="flex gap-1ch items-center"
													>
														<span>
															<input
																type="radio"
																id="travelInsurance--yes"
																name="pet_travel_insurance"
																value="yes"
																{% if is_travel_insurance_selected %}
																	checked
																{% endif %}
																required
																validate
															>
														</span>
														<span>
															<strong>{% trans 'Add travel insurance:' %}</strong>
															{% format_currency insurance_quote.travel_insurance_price request value_span_class='travelInsurance__price' %}
															{% trans ' per stay' %}
														</span>
														<button
															type="button"
															class="
																inline-flex
																items-center
																justify-center
																h-4 w-4
																font-bold
																font-brand
																text-white
																bg-brand-blue
																rounded-full
																cursor-pointer
															"
															subpage="travelInsuranceInfo"
														>i</button>
													</label>
												</div>
												<div>
													<label
														for="travelInsurance--no"
														class="flex gap-1ch items-center"
													>
														<span>
															<input
																type="radio"
																id="travelInsurance--no"
																name="pet_travel_insurance"
																value="no"
																{% if is_travel_insurance_selected == False %}
																	checked
																{% endif %}
																required
																validate
															>
														</span>
														<span>
															<strong>{% trans 'No thanks' %}</strong>
															({% trans 'Don’t protect my trip' %})
														</span>
													</label>
												</div>
											</div>
										{% endif %}
									</div>
								</div>

								<div class="flex flex-col gap-1">
									<h3 class="text-lg">
										{% trans 'Pet Policy' %}
									</h3>
									<p>
										{% call hotel 'make_pet_policy_html' request.locale as pet_policy_html %}
										{{ pet_policy_html|safe }}
										{% blocktrans trimmed %}
											Guests are responsible for any damage caused by their pets.
										{% endblocktrans %}
									</p>
								</div>

								{% if hotel.pets_allowed %}
									<div
										class="flex flex-col gap-1 insuranceOptions"
										{% if not insurance_quote %}hidden{% endif %}
									>
										<div reference="pet_damage_protection">
											<label
												for="damageProtection--yes"
												class="flex gap-1ch items-center"
											>
												<span>
													<input
														type="radio"
														id="damageProtection--yes"
														name="pet_damage_protection"
														value="yes"
														{% if is_damage_protection_selected %}
															checked
														{% endif %}
														required
														validate
													>
												</span>
												<span>
													<strong>{% trans 'Add pet damage protection:' %}</strong>
													<span>
														{% format_currency insurance_quote.damage_protection_price request value_span_class='damageProtection__price' %}
														{% trans ' per stay' %}
													</span>
												</span>
												<button
													type="button"
													class="
														inline-flex
														items-center justify-center
														font-bold
														font-brand
														text-white
														bg-brand-blue
														rounded-full
														cursor-pointer
														{% if s %}wo maa{% elif y %}{% endif %}
													"
													subpage="damageProtectionInfo"
												>i</button>
											</label>
										</div>
										<div>
											<label
												for="damageProtection--no"
												class="flex gap-1ch items-center"
											>
												<span>
													<input
														type="radio"
														id="damageProtection--no"
														name="pet_damage_protection"
														value="no"
														{% if is_damage_protection_selected == False %}
															checked
														{% endif %}
														required
														validate
													>
												</span>
												<span>
													<strong>{% trans 'No thanks' %}</strong>
													(I will be responsible for any damages)
												</span>
											</label>
										</div>
									</div>
								{% else %}
									<div
										class="insuranceOptions insuranceOptions--inPolicy"
										{% if not insurance_quote %}hidden{% endif %}
									>
										<div reference="not_pet_friendly">
											<label
												for="notPetFriendly"
												class="radio__lbl insuranceOptions__option"
											>
												<span>
													<input
														type="checkbox"
														id="notPetFriendly"
														class="checkbox"
														name="not_pet_friendly"
														required
														validate
													>
												</span>
												<span>
													I understand that this accommodation is NOT pet friendly.
												</span>
											</label>
										</div>
									</div>
								{% endif %}
							</div>
						</section>
					</div>
				</div>
				<div>
					<aside
						class="
							md:flex flex-col hidden
							gap-s1
							p-8 pb-0
							bg-gray-field
							rounded-b-none rounded-super-sm
						"
					>
						<img
							class="rounded-super-base roomImg"
							src="{{ room_type.thumbnail.url_full }}"
							width="300"
							height="200"
							alt="{{ room_type.beds_display }}"
							decoding="async"
						>
						<div class="flex flex-col gap-s-1 font-brand">
							<div class="flex gap-3 items-start justify-between w-full">
								<h2 class="shrink leading-tight text-lg">{{ hotel.name }}</h2>
								{% usekwacro stars %}
							</div>

							<p class="font-brand">
								{{ room_display_html|safe }}
							</p>

							<div class="flex flex-col gap-1">
								<div class="flex gap-3 justify-between">
									<span class="font-bold text-dark">
										{% trans 'Guests' %}
									</span>
									<span>
										{% blocktrans count c=num_adults %}{{ c }} adult{% plural %}{{ c }} adults{% endblocktrans %}{% if num_children or num_pets %},{% endif %}
										{% if num_children %}
											{% blocktrans count c=num_children %}{{ c }} child{% plural %}{{ c }} children{% endblocktrans %}{% if num_pets %},{% endif %}
										{% endif %}
										{% blocktrans count c=num_pets %}{{ c }} pet{% plural %}{{ c }} pets{% endblocktrans %}
									</span>
								</div>
								<div class="flex gap-3 justify-between">
									<span class="font-bold text-dark">
										{% trans 'Arrival' %}
									</span>
									<span>
										{{ arrival|date:date_format_string }}
									</span>
								</div>
								<div class="flex gap-3 justify-between">
									<span class="font-bold text-dark">
										{% trans 'Departure' %}
									</span>
									<span>
										{{ departure|date:date_format_string }}
									</span>
								</div>
							</div>

							<p class="text-right" x-data>
								<button
									type="button"
									class="link"
									@click.prevent="$dispatch('modal', {key: 'tripDetails'});"
								>
									{% trans 'Change details' %}
								</button>
							</p>
						</div>

						<hr class="border-2 opacity-50">
					</aside>
					<!-- Another div so it can be sticky -->
					<aside
						class="
							sticky
							lg:top-[var(--header-height)]
							top-[var(--header-height-sm)]
							md:flex flex-col hidden
							gap-s1
							p-8 pt-4
							bg-gray-field
							rounded-super-sm rounded-t-none
						"
					>
						<div class="flex flex-col gap-s-1">
							<h1 class="font-bold text-lg">{% trans 'Summary of Charges' %}</h1>
							<div class="flex flex-col gap-1">
								{% if rate.deal %}
									<span class="font-brand">{{ rate.deal.label }}</span>
								{% endif %}
								{% if rate.nightly_rates %}
									<details class="flex flex-col gap-1">
										<summary
											class="
												relative
												-ml-4
												w-[calc(100%_+_calc(var(--spacing)_*_4))]
											"
										>
											<span
												class="
													absolute left-4
													w-[calc(100%_-_calc(var(--spacing)_*_4))]
												"
											>
												<span class="flex gap-1ch justify-between">
													<span class="font-bold font-brand text-dark">
														{{ num_nights }} {% blocktrans count c=num_nights %}night{% plural %}nights{% endblocktrans %} ×
														{% if rate.deal %}
															<span
																class="
																	font-normal
																	text-plain
																	line-through
																"
															>{% format_currency rate.deal.original_amount request is_long=False skip_currency=True %}</span>
														{% endif %}
														{% format_currency rate.average_nightly_rate request is_long=False skip_currency=True %}{% if num_rooms > 1 %}/{% elif num_nights > 1 %}/avg{% endif %}
													</span>
													<span>
														{% format_currency rate.subtotal request skip_currency=True %}
													</span>
												</span>
											</span>
										</summary>

										{% for nightly_rate in rate.nightly_rates %}
											<div class="flex gap-1ch justify-between ps-2">
												<span class="font-brand">
													{{ nightly_rate.date|date:date_format_string }}
												</span>
												<span>
													{% format_currency nightly_rate.amount request skip_currency=True %}
												</span>
											</div>
										{% endfor %}
									</details>
								{% else %}
									<div class="flex gap-1ch justify-between">
										<span class="font-bold font-brand text-dark">
											{{ num_nights }} {% blocktrans count c=num_nights %}night{% plural %}nights{% endblocktrans %} ×
											{% if rate.deal %}<span class="dataSheet__lbl--strikethrough">
													{% format_currency rate.deal.original_amount request is_long=False skip_currency=True %}</span>
											{% endif %}
											{% format_currency rate.average_nightly_rate request is_long=False skip_currency=True %}{% if num_rooms > 1 %}/{% trans 'room' %}{% elif num_nights > 1 %}/avg{% endif %}
										</span>
										<span>
											{% format_currency rate.subtotal request skip_currency=True %}
										</span>
									</div>
								{% endif %}
							</div>

							<div class="flex flex-col gap-1">
								{% for included_fee in rate.included_fees %}
									<div class="flex gap-1ch justify-between">
										<span class="font-bold font-brand text-dark">
											{{ included_fee.description }}
										</span>
										<span>
											{% format_currency included_fee.amount request skip_currency=True %}
										</span>
									</div>
								{% endfor %}
								<div
									class="insuranceSummary"
									{% if not is_travel_insurance_selected and not is_damage_protection_selected %}
										hidden
									{% endif %}
								>
									<div
										class="
											flex
											gap-1ch justify-between
											travelInsuranceSummary
										"
										<div
									>
										{% if not is_travel_insurance_selected %}hidden{% endif %}
										>
										<span class="font-bold font-brand text-dark">
											{% trans 'Travel Insurance' %}
										</span>
										<span>
											{% format_currency insurance_quote.travel_insurance_price request value_span_class='travelInsurance__price' %}
										</span>
									</div>
									<div
										class="
											flex
											gap-1ch justify-between
											damageProtectionSummary
										"
										{% if not is_damage_protection_selected %}
											hidden
										{% endif %}
									>
										<span class="font-bold font-brand text-dark">
											{% trans 'Pet Damage Protection' %}
										</span>
										<span>
											{% format_currency insurance_quote.damage_protection_price request value_span_class='damageProtection__price' %}
										</span>
									</div>
								</div>
								{% for fee in rate.additional_fees %}
									<div class="flex gap-1ch justify-between">
										<span class="font-bold font-brand text-dark">
											{{ fee.description }}
											{% if rate.is_prepay %}
												<span class="font-normal font-plain">(due at check-in)</span>
											{% endif %}
										</span>
										<span>
											{% format_currency fee.amount request skip_currency=True %}
										</span>
									</div>
								{% endfor %}
								{% if rate.host_fee %}
									<div class="flex gap-1ch justify-between">
										<span class="font-bold font-brand text-dark">
											{% trans 'Host fees' %}
											<span class="feeHelp">
												<span class="feeHelp__icon">?</span>
												<div
													class="
														feeHelp__text
														feeHelp__text--scootRight
													"
												>
													{% blocktrans trimmed %}
														Includes cleaning fee, management fee, and other fees specified by the&nbsp;host.
													{% endblocktrans %}
												</div>
											</span>
										</span>
										<span>
											{% format_currency rate.host_fee request skip_currency=True %}
										</span>
									</div>
								{% endif %}
								{% if hotel_details.is_vrbo and rate.platform_fee %}
									<div class="flex gap-1ch justify-between">
										<span class="font-bold font-brand text-dark">
											{% trans 'Partner service fee' %}
											<span class="feeHelp">
												<span class="feeHelp__icon">?</span>
												<div class="feeHelp__text">
													{% blocktrans trimmed %}
														This booking is facilitated by Vrbo. They charge a service fee for a secure booking experience and 24/7 support throughout the duration of your&nbsp;trip.
													{% endblocktrans %}
												</div>
											</span>
										</span>
										<span>
											{% format_currency rate.platform_fee request skip_currency=True %}
										</span>
									</div>
								{% endif %}
								<div class="flex gap-1ch justify-between">
									<span class="font-bold font-brand text-dark">
										{% if hotel_details.is_vrbo and rate.platform_fee %}
											BringFido {% trans 'service fee' %}
										{% else %}
											{% trans 'Booking fee' %}
										{% endif %}
									</span>
									<span>
										{% format_currency 0.00 request skip_currency=True %}
									</span>
								</div>
							</div>

							<div class="flex gap-1ch justify-between">
								<span class="font-bold font-brand text-dark text-lg">
									{% trans 'Total' %}
								</span>
								<span class="font-bold font-brand text-dark text-lg">
									{% format_currency rate.grand_total_with_extras request is_final=True is_in_usa=is_in_usa value_span_class='runningGrandTotal' %}
								</span>
							</div>

							<div class="paymentInfo">
								<div
									class="insuranceText insuranceText--yes"
									{% if not insurance_price %}hidden{% endif %}
								>
									{% make_payment_info_safe request hotel rate arrival departure insurance_amount=insurance_price %}
								</div>
								<div
									class="insuranceText insuranceText--no"
									{% if insurance_price %}hidden{% endif %}
								>
									{% make_payment_info_safe request hotel rate arrival departure %}
								</div>
							</div>

							<hr class="border-2 opacity-50">

							<div>
								<button
									type="button"
									class="inline link"
									subpage="additionalRules"
								>{% trans 'Additional Rules' %}</button>
							</div>
						</div>
					</aside>
				</div>
			</div>

			<div
				id="complete"
				class="flex flex-col gap-s4 text-center"
				{% if page == 1 %}hidden{% endif %}
			>
				<hr>

				<input
					type="submit"
					id="submitBtn"
					class="mx-auto w-full md:w-1/3 text-xl button"
					value="{% trans 'Complete Booking' %}"
				>
				<button
					type="button"
					id="applePayButton"
					class="
						mx-auto
						w-full md:w-1/3
						text-xl
						bg-black
						button appearance-apple
					"
					hidden
				>Book with &#63743; Pay</button>
				<p class="mx-auto">
					{% url 'terms' as terms_url %}
					{% url 'privacy' as privacy_url %}
					{% blocktrans trimmed %}
						By completing this booking, you acknowledge that you have read and accepted our <a href="{{ privacy_url }}" target="_blank">Privacy&nbsp;Policy</a> and <a href="{{ terms_url }}" target="_blank">Terms&nbsp;&amp;&nbsp;Conditions</a> as well as the other hotel policies listed above.
					{% endblocktrans %}
				</p>
				{% if user.is_staff %}
					<div class="text-brand-blue" hidden>{% trans 'Great job, ' %} {{ request.user.first_name }}!</div>
				{% endif %}
			</div>
		</form>
	</div>

	{% include 'hotel/_fragments/book_change_details_modal.clean.html' %}

	<div id="applePay"></div>
{% endblock %}

{% block body_bottom %}
	{% include '_fragments/footer.clean.html' %}

	{{ block.super }}

	<div
		layout="nodisplay"
		role="dialog"
		x-cloak
		x-data
		x-show="$store.popout.is('compactRateSummary')"
	>
		<div class="absolute inset-0 -z-1" tabindex="0" role="button" @click="close"></div>
		<div
			class="
				h-full
				md:h-auto
				max-h-full
				md:max-w-100
				md:max-h-[calc(100%_-_calc(var(--spacing)_*_2))]
				w-full
				overflow-y-auto
				bg-white
				md:rounded-super-sm
				md:shadow-high
				overscroll-contain
			"
		>
			<div
				class="
					flex flex-col
					p-8 pb-12
					md:min-h-0 min-h-full-scroll
					box-border
				"
			>
				asdf
			</div>
		</div>
	</div>

	<bento-lightbox id="additionalRules" class="dialog" hidden layout="nodisplay" role="dialog">
		<div class="dialog__closeArea" tabindex="0" close role="button"></div>

		<div class="dialog__contentWrapper">
			<div class="dialog__content dialog__content--wide dialog__content--infoWindow">
				<div class="toolbar toolbar--tall">
					<span class="toolbar__title">
						{% trans 'Additional&nbsp;Rules' %}
					</span>

					<button
						type="button"
						class="
							nakedIcon
							toolbar__brick
							toolbar__brick--tall
							toolbar__brick--right
							dialog__dismissBtn
						"
						tabindex="0"
						close
					>
						<svg width="12px" height="12px" viewbox="0 0 12 12">
							<title>{% trans 'Close' %}</title>
							<g fill="none" fill-rule="evenodd">
								<g
									class="strokeColor--touchable"
									stroke-width="2"
									transform="translate(6, 6) rotate(-45) translate(-6, -6) translate(-1, -1)"
								>
									<path d="M0,7 L14,7"></path>
									<path d="M7,14 L7,0"></path>
								</g>
							</g>
						</svg>
					</button>
				</div>

				<div class="dialog__content--infoWindow__body dialog__autoformat">
					{% if hotel_details.check_in_time %}
						<div class="spacedBlock spacedBlock--multiple">
							<div>
								<div class="introStub introStub--block">
									{% trans 'Check-in' %}
								</div>
								{{ hotel_details.check_in_time }}
							</div>
							{% if hotel_details.check_out_time %}
								<div>
									<div class="introStub introStub--block">
										{% trans 'Check-out' %}
									</div>
									{{ hotel_details.check_out_time }}
								</div>
							{% endif %}
						</div>
					{% endif %}

					<div class="spacedBlock cancellationPolicy">
						<div class="introStub introStub--block">{% trans 'Cancellation Policy' %}</div>
						{% make_cancellation_policy_html_safe request hotel rate arrival %}
					</div>

					<div class="spacedBlock">
						<div class="introStub introStub--block">{% trans 'Pet Policy' %}</div>
						{% call hotel 'make_pet_policy_html' request.locale as pet_policy_html %}
						{{ pet_policy_html|safe }}
						{% blocktrans trimmed %}
							Guests are responsible for any damage caused by their pets.
						{% endblocktrans %}
						{% if hotel_details.is_vrbo %}
							{% if rate.card_on_file_limit %}
								Vrbo reserves the right to charge your card on file for the amount of the damage, up to {% format_currency rate.card_on_file_limit request skip_currency=True %}.
							{% elif rate.refundable_deposit %}
								This property requires an additional {% format_currency rate.refundable_deposit request skip_currency=True %} refundable deposit. If there is no damage, your deposit will be automatically refunded approximately 10 days after checkout.
							{% endif %}
						{% endif %}
					</div>

					{% if rate.special_features or rate.special_offer_description %}
						<div class="spacedBlock">
							<div class="introStub introStub--block">{% trans 'Extras' %}</div>
							{% if rate.special_features %}
								<ul>
									{% for special_feature in rate.special_features %}
										<li>{{ special_feature }}</li>
									{% endfor %}
								</ul>
							{% elif rate.special_offer_description %}
								{{ rate.special_offer_description }}
							{% endif %}
						</div>
					{% endif %}

					{% if hotel_details.is_vrbo %}
						{% if hotel_details.guest_restrictions_html %}
							<div class="spacedBlock">
								<div class="introStub introStub--block">
									{% trans 'Guest Restrictions' %}
								</div>
								{{ hotel_details.guest_restrictions_html|html }}
							</div>
						{% endif %}
						{% if hotel_details.prohibited_use_html %}
							<div class="spacedBlock">
								<div class="introStub introStub--block">
									{% trans 'Prohibited Use' %}
								</div>
								{{ hotel_details.prohibited_use_html|html }}
							</div>
						{% endif %}
						{% if hotel_details.house_rules_html %}
							<div class="spacedBlock">
								<div class="introStub introStub--block">
									{% trans 'House Rules' %}
								</div>
								{{ hotel_details.house_rules_html|html }}
							</div>
						{% endif %}
					{% else %}
						<div class="spacedBlock">
							<div class="introStub introStub--block">{% trans 'Occupancy' %}</div>
							{{ room_type.guests_display }}.

							{% if hotel_details.min_booking_age %}
								{% blocktrans trimmed %}
									The primary guest must be at least {{ hotel_details.min_booking_age }} years old.
								{% endblocktrans %}
							{% endif %}

							{% if not is_bed_configuration_guaranteed %}
								{% blocktrans trimmed %}
									The selected bed configuration is one of several available and is not guaranteed.
								{% endblocktrans %}
							{% endif %}
						</div>
					{% endif %}

					{% if hotel_details.check_in_instructions_html %}
						<div class="spacedBlock">
							<div class="introStub introStub--block">
								{% trans 'Check-in Instructions' %}
							</div>
							{{ hotel_details.check_in_instructions_html|html }}

							{% if hotel_details.special_check_in_instructions_html %}
								<div class="spacedBlock">
									{{ hotel_details.special_check_in_instructions_html|html }}
								</div>
							{% endif %}
						</div>
					{% endif %}

					{% if hotel_details.special_instructions_html %}
						<div class="spacedBlock">
							<div class="introStub introStub--block">
								{% trans 'Special Instructions' %}
							</div>
						</div>
						<div class="spacedBlock">
							{{ hotel_details.special_instructions_html|html }}
						</div>
					{% endif %}

					{% if hotel_details.is_vrbo and rental_terms_url %}
						<div class="spacedBlock">
							<div class="introStub introStub--block">
								{% trans 'Rental Agreement' %}
							</div>
							<p>View additional <a href="{{ rental_terms_url }}" target="_blank">{% if hotel_details.is_vrbo %}Vrbo {% endif %}terms of booking {% usekwacro new_window_icon %}</a>{% if hotel_details.rental_agreement_url %} or download the <a href="{{ hotel_details.rental_agreement_url }}">rental agreement</a>{% endif %}.</p>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</bento-lightbox>

	<bento-lightbox id="travelInsuranceInfo" class="dialog" layout="nodisplay" role="dialog">
		<div class="dialog__closeArea" tabindex="0" close role="button"></div>

		<div class="dialog__contentWrapper">
			<div class="dialog__content dialog__content--infoWindow">
				<div>
					<div class="toolbar toolbar--tall">
						<span class="toolbar__title toolbar__title--strong">
							{% trans 'Travel Insurance' %}
						</span>

						<button
							type="button"
							class="
								nakedIcon
								toolbar__brick
								toolbar__brick--tall
								toolbar__brick--right
								dialog__dismissBtn
							"
							tabindex="0"
							close
						>
							<svg width="12px" height="12px" viewbox="0 0 12 12">
								<title>{% trans 'Close' %}</title>
								<g fill="none" fill-rule="evenodd">
									<g
										class="strokeColor--touchable"
										stroke-width="2"
										transform="translate(6, 6) rotate(-45) translate(-6, -6) translate(-1, -1)"
									>
										<path d="M0,7 L14,7"></path>
										<path d="M7,14 L7,0"></path>
									</g>
								</g>
							</svg>
						</button>
					</div>
				</div>

				<div class="dialog__content--infoWindow__body">
					<h2 class="h compactRateSummary__h">
						{% trans 'Price' %}
					</h2>

					<p>
						{% trans 'It costs just ' %}
						{% format_currency insurance_quote.travel_insurance_price request value_span_class='travelInsurance__price' %}
						{% trans ' to insure your trip.' %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Trip Cancellation' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							If your trip is canceled due to an accident, illness, severe weather, or the death of your pet, receive up to 100% of the covered trip costs.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Trip Interruption' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							Receive up to 150% of your covered trip costs if your travel is disrupted due to your pet’s critical illness or death, your own illness or injury, or a natural disaster.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Refund Policy' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							Battleface allows 10 days to review your policy. If, during this 10-day period, you are not completely satisfied for any reason, you may cancel your policy and receive a full refund. Please note that this refund is only available if the covered trip has not started and if a claim has not been initiated. After this 10-day period, your premium is non-refundable.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<p>
						<a
							href="https://www.battleface.com/wp-content/uploads/important-notices-and-disclosures-bringfido.pdf"
							target="_blank"
						>
							{% trans 'Important Notices &amp; Disclosures' %}
							{% usekwacro new_window_icon %}
						</a>
					</p>

					<p>
						<a href="https://www.battleface.com/bringfido-library/" target="_blank">
							{% trans 'Policy Document' %}
							{% usekwacro new_window_icon %}
						</a>
					</p>
				</div>
			</div>
		</div>
	</bento-lightbox>

	<bento-lightbox id="damageProtectionInfo" class="dialog" layout="nodisplay" role="dialog">
		<div class="dialog__closeArea" tabindex="0" close role="button"></div>

		<div class="dialog__contentWrapper">
			<div class="dialog__content dialog__content--infoWindow">
				<div>
					<div class="toolbar toolbar--tall">
						<span class="toolbar__title toolbar__title--strong">
							{% trans 'Pet Damage Protection' %}
						</span>

						<button
							type="button"
							class="
								nakedIcon
								toolbar__brick
								toolbar__brick--tall
								toolbar__brick--right
								dialog__dismissBtn
							"
							tabindex="0"
							close
						>
							<svg width="12px" height="12px" viewbox="0 0 12 12">
								<title>{% trans 'Close' %}</title>
								<g fill="none" fill-rule="evenodd">
									<g
										class="strokeColor--touchable"
										stroke-width="2"
										transform="translate(6, 6) rotate(-45) translate(-6, -6) translate(-1, -1)"
									>
										<path d="M0,7 L14,7"></path>
										<path d="M7,14 L7,0"></path>
									</g>
								</g>
							</svg>
						</button>
					</div>
				</div>

				<div class="dialog__content--infoWindow__body">
					<h2 class="h compactRateSummary__h">
						{% trans 'Price' %}
					</h2>

					<p>
						{% trans 'It costs just ' %}
						{% format_currency insurance_quote.damage_protection_price request value_span_class='damageProtection__price' %}
						{% trans ' to add Pet Damage Protection.' %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Property Coverage' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							If your pet has an accident or damages the room in any way, Pet Damage Protection provides up to $1,500 of coverage. Damage caused by humans is also covered.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Pet Medical' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							If your pet gets sick or injured during your trip, receive up to $2,000 to cover unexpected veterinary expenses ($100 deductible applies). If you become sick or injured and are unable to care for your pet during the trip, receive up to $500 to get them home safely.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Exclusions' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							Pet Damage Protection does not cover any damages due to normal wear and tear, natural disasters, gross negligence, intentional acts of vandalism, or non-compliance with the property’s rules. Any thefts must be reported to the police immediately. Other damage must be reported to the hotel staff before the check-out date.
						{% endblocktrans %}
					</p>

					<p>
						{% blocktrans trimmed %}
							Pet return is not available to FL residents.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<h2 class="h compactRateSummary__h">
						{% trans 'Refund Policy' %}
					</h2>

					<p>
						{% blocktrans trimmed %}
							Battleface allows 10 days to review your policy. If, during this 10-day period, you are not completely satisfied for any reason, you may cancel your policy and receive a full refund. Please note that this refund is only available if the covered trip has not started and if a claim has not been initiated. After this 10-day period, your premium is non-refundable.
						{% endblocktrans %}
					</p>

					<hr class="hr">

					<p>
						<a
							href="https://www.battleface.com/wp-content/uploads/important-notices-and-disclosures-bringfido.pdf"
							target="_blank"
						>
							{% trans 'Important Notices &amp; Disclosures' %}
							{% usekwacro new_window_icon %}
						</a>
					</p>

					<p>
						<a href="https://www.battleface.com/bringfido-library/" target="_blank">
							{% trans 'Policy Document' %}
							{% usekwacro new_window_icon %}
						</a>
					</p>
				</div>
			</div>
		</div>
	</bento-lightbox>

	{% include '_elements/modal.clean.html' only %}
	{% include '_elements/date_input.clean.html' only %}

	<script>
		{% include '_elements/scripts/book.js' only %}
		{% include '_elements/scripts/date_input.js' only %}
	</script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key={{ gm_api_key }}&loading=async&libraries=places&callback=Function.prototype"
		async
	></script>
	<script>
		{% include '_elements/scripts/address_autocomplete.js' only %}
	</script>
{% endblock %}

{% block page_data %}
	{{ block.super }},

	giftCodeURL: "/lodging/gift_code/",
	insuranceQuoteURL: "{% url 'hotel_insurance_quote' hotel.id %}",

	hotelID: {{ hotel.id|json }},
	arrival: {{ arrival|json }},
	departure: {{ departure|json }},

	total: {{ rate.total|json }},
	grandTotal: {{ rate.grand_total|json }},
	refundableDeposit: {{ rate.refundable_deposit|json }},
	travelInsurancePrice: {{ insurance_quote.travel_insurance_price|json }},
	damageProtectionPrice: {{ insurance_quote.damage_protection_price|json }},

	travelInsuranceAvailable: {% if insurance_quote %}true{% else %}false{% endif %},
	damageProtectionAvailable: {% if insurance_quote %}true{% else %}false{% endif %},

	statesByCountryCode: {{ states_by_country_code|json }},
	postalCodeFormatsByCountryCode: {{ postal_code_formats_by_country_code|json }},
	creditCardTypes: {
	{% for card_type in credit_card_types %}
		{{ card_type|json }}: {
		prefixes: {{ card_type.prefixes|json }},
		securityCodeLength: {{ card_type.security_code_length|json }},
		formattingGaps: {{ card_type.formatting_gaps|json }},
		maxLength: {{ card_type.max_length|json }},
		brandSlug: {{ card_type.brand_slug|json }}
		}{% if not forloop.last %},{% endif %}
	{% endfor %}
	},
	amexAccepted: {{ rate.accepts_amex|json }},
	jcbAccepted: {{ rate.accepts_jcb|json }},
	discoverAccepted: {{ rate.accepts_discover|json }},
	otherAccepted: {{ rate.accepts_other|json }},
	applePayEligible: {{ is_apple_pay_eligible|json }},
	errorMessages: {
	"pet_travel_insurance": {"required": "{% trans 'Please make a selection.' %}"},
	"pet_damage_protection": {"required": "{% trans 'Please make a selection.' %}"},
	{% if not hotel.pets_allowed %}
		"not_pet_friendly": {"required": "{% trans 'Please check this box.' %}"},
	{% endif %}
	{% for fieldName, field in form.fields.items %}
		{{ fieldName|json }}: {{ field.error_messages|json }},
	{% endfor %}
	{% for fieldName, error_messages in card_form.combo_field_error_messages.items %}
		{{ fieldName|json }}: {{ error_messages|json }},
	{% endfor %}
	"name": {{ card_form.fields.name.error_messages|json }},
	"number": {{ card_form.fields.number.error_messages|json }},
	"expiry_month": {{ card_form.fields.expiry_month.error_messages|json }},
	"expiry_year": {{ card_form.fields.expiry_year.error_messages|json }},
	"nickname": {{ card_form.fields.nickname.error_messages|json }}
	},
	passwordInstructions: "{% trans 'To save your payment information, be sure to enter a password in Section 1 (above).' %}",
	staffEmail: {% if request.user.is_staff %}{{ request.user.email|json }}{% else %}null{% endif %},
	wordSubmitting: "{% trans 'Submitting…' %}",
	wordZipCode: "{% trans 'Zip code' %}",
	wordPostalCode: "{% trans 'Postal code' %}",
	wordExpiration: "{% trans 'Expires' %}",
	wordApply: "{% trans 'Apply' %}",
	wordApplying: "{% trans 'Applying' %}",
	googlePlacesApiKey: "{{ gm_api_key }}"
{% endblock %}
